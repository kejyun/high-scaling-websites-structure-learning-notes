# 大型網站架構概念

當一個網站需要服務很多很多很多人的時候，我們就需要好的存取資料的架構，讓使用者能夠很快的拿到他想要拿的資料，這樣伺服器（Web & Database）才可以有更多「`時間`」及「`空間`」去服務更多的人。

你可能會聽到有一些在提高伺服器存取效率的關鍵字，像是「資料快取」、「資料庫索引」、「資料庫讀寫分離」、「資料分散式處理」...等等之類的方式。

## 提高效能存取的概念

### 不常異動的資料做快取

例如在部落格中，作者發表一篇文章後，除了文章內有一些小小的錯誤或錯字需要編輯修改，否則大部份的時間文章都是不會去異動的。

在動態去資料庫存取本篇文章時，我們可能會使用這樣的 SQL 語法去存取：

```sql
SELECT * FROM posts WHERE post_id = '部落格文章編號' Limit 1;
```

當每個使用者要來看這篇文章時，都需要透過這樣的 SQL 指令去撈取這篇文章的資訊（標題、內文...blabla），如果文章讀者不多時，偶爾這樣取資料庫撈資料還撐得過去，但像是比較熱門被轉載的文章，每分鐘可能有好幾百幾千人要去看這篇文章的資料，對於資料庫就是執行 1000 次這樣相同的語法去取得相同的資料（要記得，資料庫的存取是很昂貴的）。

為了減少資料庫存取次數，所以在程式方面我們會將這些不長異動的資料在第一次從資料庫撈取之後，把它`快取`下來，可能用 `Memcached`、`Redis` 或 `File` 的方式將資料預先存下來，然後再設定資料的過期時間，當超過過期時間後，再重複去資料庫撈取資料。

這樣可以減少資料庫的運算資源，使用者也可以很快地拿到他們想要看的資料，提高了伺服器對於資料的存取量。


### 減少資料量



## 重要觀念

### 資料庫存取是很昂貴的

每下一段資料庫 SQL 語法去撈取資料，資料庫就要對資料去進行比對運算，當資料很龐大，SQL 語法又太複雜導致運算很繁瑣時，資料庫需要進行運算的時間又會變得更久，所以建立好的索引（Index）及下好的 SQL 語法是很重要的工作

> 雖然資料都撈得出來，但是撈得漂亮，撈得快也是一種藝術啊～

### 對於需要當作查詢的資料必須建立索引

我們會依照我們想要撈取的資料下 `WHERE`、`GROUP BY`、`ORDER BY` ...等等的條件去撈取我們想要撈取的資料，如果不建立索引資料庫也是有辦法將資料撈出來，只是速度會比較慢，當這些條件資料有預先做索引時，資料庫可以很快地利用索引去完成查詢的動作

> 索引原理就是將資料透過資料結構（e.g. B-tree, Hash）預先做排序的存放，使用索引時資料庫可以很快的資料放在哪一個地方，以達到快速撈取資料的目的

#### ***以書籍為例***

索引就像書籍最前面的目錄一樣，可以很快地告訴我們哪一段章節的資料在第幾頁，所以我們就可以很快地翻閱到我們想看的資料，如果書籍沒有做目錄（索引）的話，我們要找到特定章節的資料時，我們就需要從頭到尾翻閱去查看看我們要看的資料到底在哪一頁，這對於書籍的讀者來說是相當浪費時間的一件事。

*詳細的索引說明會在稍後章節提到*


## 參考資料
* [B樹 - 維基百科，自由的百科全書](http://zh.wikipedia.org/wiki/B%E6%A0%91)
* [全文檢索 - 維基百科，自由的百科全書](http://zh.wikipedia.org/wiki/%E5%85%A8%E6%96%87%E6%AA%A2%E7%B4%A2)
